<odoo>
    <data>
        <record id="rule_pph21_ptkp" model="hr.salary.rule">
            <field name="name">Penghasilan Tidak Kena Pajak</field>
            <field name="category_id" ref="hr_payroll_community.DED"/>
            <field name="code">PTKP</field>
            <field name="sequence">190</field>
            <field name="amount_select">code</field>
            <field name="amount_python_compute">result=employee.ptkp_id.nominal</field>
        </record>

        <record id="rule_pph21_disetahunkan" model="hr.salary.rule">
            <field name="name">PenghasilanSetahunkan</field>
            <field name="category_id" ref="hr_payroll_community.DED"/>
            <field name="code">PSTH</field>
            <field name="sequence">200</field>
            <field name="amount_select">code</field>
            <field name="amount_python_compute">result=(contract.wage+contract.x_trans+contract.x_occup+contract.x_family+contract.x_functional+contract.x_perform)*12</field>
        </record>

        <record id="rule_pph21_biayajabatan" model="hr.salary.rule">
            <field name="name">BiayaJabatan</field>
            <field name="category_id" ref="hr_payroll_community.DED"/>
            <field name="code">BJAB</field>
            <field name="sequence">300</field>
            <field name="amount_select">code</field>
            <field name="amount_python_compute">result= min(0.05 * PSTH , 6000000)</field>
        </record>

        <record id="rule_pph21_netto" model="hr.salary.rule">
            <field name="name">Netto</field>
            <field name="category_id" ref="hr_payroll_community.DED"/>
            <field name="code">NETTO</field>
            <field name="sequence">400</field>
            <field name="amount_select">code</field>
            <field name="amount_python_compute">result= PSTH-BJAB-(contract.wage+contract.x_tpk+contract.x_occup+contract.x_trans+contract.x_family+contract.x_presence+contract.x_functional)*0.02*12</field>
        </record>

        <record id="rule_pph21_pkp" model="hr.salary.rule">
            <field name="name">Pendapatan Kena Pajak</field>
            <field name="category_id" ref="hr_payroll_community.DED"/>
            <field name="code">PKP</field>
            <field name="sequence">500</field>
            <field name="amount_select">code</field>
            <field name="amount_python_compute">result=NETTO-PTKP if NETTO-PTKP>0 else 0</field>
        </record>

        <record id="rule_pph21_setahun" model="hr.salary.rule">
            <field name="name">PPH21 Setahun</field>
            <field name="category_id" ref="hr_payroll_community.DED"/>
            <field name="code">PPH21</field>
            <field name="sequence">600</field>
            <field name="amount_select">code</field>
            <field name="amount_python_compute"><![CDATA[
pkp_id = contract.company_id.pkp_ids.search([('minimum','<',PKP),('maximum','>',PKP)])
rate=pkp_id[0].rate
result = PKP*rate/100.0
]]>
            </field>
        </record>

        <record id="aag_add_field.structurexacti_karyawan_tetap_ns" model="hr.payroll.structure">
            <field name="name">Karyawan tetap NS</field>
            <field name="parent_id" ref="hr_payroll_community.structure_base"/>
            <field name="code">KTNS</field>
            <field name="rule_ids" eval="[(4,ref('rule_pph21_ptkp')),
             (4,ref('rule_pph21_disetahunkan')),
             (4,ref('rule_pph21_biayajabatan')),
             (4,ref('rule_pph21_netto')),
             (4,ref('rule_pph21_pkp')),
             (4,ref('rule_pph21_setahun'))
             ]"/>
        </record>

    </data>
</odoo>